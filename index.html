<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trivaci Digital Agency</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        .trivaci-gradient {
            background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 25%, #C084FC 50%, #E879F9 75%, #F0ABFC 100%);
        }
        .trivaci-gradient-dark {
            background: linear-gradient(135deg, #7C3AED 0%, #9333EA 25%, #A855F7 50%, #C084FC 75%, #D946EF 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card-modern {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.1);
            box-shadow: 0 20px 25px -5px rgba(139, 92, 246, 0.1), 0 10px 10px -5px rgba(139, 92, 246, 0.04);
        }
        .loading-spinner {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top: 3px solid #8B5CF6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .trivaci-logo {
            font-weight: 800;
            font-size: 1.75rem;
            background: linear-gradient(45deg, #FFFFFF, #F0ABFC);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(240, 171, 252, 0.5);
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.25);
        }
        .nav-btn-active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }
        .floating-elements::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        .floating-elements::after {
            content: '';
            position: absolute;
            bottom: 10%;
            right: 10%;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(192, 132, 252, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite reverse;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-purple-50 via-white to-pink-50">
  <div class="min-h-full"><!-- Header -->
   <header class="trivaci-gradient shadow-2xl relative overflow-hidden">
    <div class="floating-elements"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
     <div class="flex justify-between items-center py-8">
      <div class="flex items-center space-x-4">
       <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center backdrop-blur-sm">
        <svg class="w-8 h-8 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
        </svg>
       </div>
       <div>
        <h1 id="agency-name" class="trivaci-logo">TRIVACI</h1>
        <p class="text-white text-opacity-90 text-sm font-medium">Digital Agency</p>
       </div>
      </div>
      <nav class="hidden md:block">
       <div class="flex items-center space-x-2"><button onclick="showSection('dashboard')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸ“Š Dashboard </button> <button onclick="showSection('analytics')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸ“ˆ Analytics </button> <button onclick="showSection('crm')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸ¯ CRM </button> <button onclick="showSection('publicidade')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸ“¢ Publicidade </button> <button onclick="showSection('trading')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸ’ Trading </button> <button onclick="showSection('marketplace')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸª Marketplace </button> <button onclick="showSection('financeiro')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> ğŸ’° Financeiro </button> <button onclick="showSection('configuracoes')" class="nav-btn glass-effect text-white hover:bg-white hover:bg-opacity-20 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300"> âš™ï¸ Config </button>
       </div>
      </nav>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="max-w-7xl mx-auto py-8 sm:px-6 lg:px-8"><!-- Analytics Section -->
    <div id="analytics-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 flex justify-between items-center">
       <div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Analytics AvanÃ§ados</h2>
        <p class="text-gray-600 text-lg">AnÃ¡lises detalhadas e previsÃµes inteligentes</p>
       </div>
       <div class="flex gap-4"><button onclick="exportAnalytics()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ“Š Exportar RelatÃ³rio </button> <button onclick="generateForecast()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ”® Gerar PrevisÃ£o </button>
       </div>
      </div><!-- MÃ©tricas AvanÃ§adas -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">ROI MÃ©dio</p>
           <p id="avg-roi" class="text-3xl font-bold text-gray-900">0%</p>
           <p id="roi-trend" class="text-sm text-green-600 mt-1">â†— +5.2% vs mÃªs anterior</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ“ˆ</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Taxa ConversÃ£o</p>
           <p id="conversion-rate" class="text-3xl font-bold text-gray-900">0%</p>
           <p id="conversion-trend" class="text-sm text-blue-600 mt-1">â†— +2.1% vs mÃªs anterior</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ¯</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Ticket MÃ©dio</p>
           <p id="avg-ticket" class="text-3xl font-bold text-gray-900">R$ 0</p>
           <p id="ticket-trend" class="text-sm text-purple-600 mt-1">â†— +12.5% vs mÃªs anterior</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ’³</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">PrevisÃ£o Mensal</p>
           <p id="monthly-forecast" class="text-3xl font-bold text-gray-900">R$ 0</p>
           <p class="text-sm text-orange-600 mt-1">ğŸ”® Baseado em IA</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸš€</span>
          </div>
         </div>
        </div>
       </div>
      </div><!-- GrÃ¡ficos AvanÃ§ados -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mr-3"></span> TendÃªncia de Vendas (6 meses)</h3>
        <canvas id="trendsChart" width="400" height="200"></canvas>
       </div>
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-green-500 to-blue-500 rounded-full mr-3"></span> Performance por Plataforma</h3>
        <canvas id="platformChart" width="400" height="200"></canvas>
       </div>
      </div><!-- AnÃ¡lise de ConcorrÃªncia -->
      <div class="card-modern p-8 rounded-2xl mb-8">
       <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-red-500 to-pink-500 rounded-full mr-3"></span> AnÃ¡lise de ConcorrÃªncia</h3>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-gradient-to-br from-red-50 to-pink-50 p-6 rounded-xl border border-red-100">
         <h4 class="font-bold text-red-800 mb-2">PreÃ§o MÃ©dio Mercado</h4>
         <p class="text-2xl font-bold text-red-600" id="market-avg">R$ 2.850</p>
         <p class="text-sm text-red-500 mt-1">Instagram 10k-50k seguidores</p>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-100">
         <h4 class="font-bold text-green-800 mb-2">Nossa MÃ©dia</h4>
         <p class="text-2xl font-bold text-green-600" id="our-avg">R$ 3.200</p>
         <p class="text-sm text-green-500 mt-1">+12.3% acima do mercado</p>
        </div>
        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-100">
         <h4 class="font-bold text-blue-800 mb-2">Oportunidade</h4>
         <p class="text-2xl font-bold text-blue-600">+R$ 350</p>
         <p class="text-sm text-blue-500 mt-1">Potencial por venda</p>
        </div>
       </div>
      </div>
     </div>
    </div><!-- CRM Section -->
    <div id="crm-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 flex justify-between items-center">
       <div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">CRM - GestÃ£o de Clientes</h2>
        <p class="text-gray-600 text-lg">Relacionamento e histÃ³rico completo dos clientes</p>
       </div>
       <div class="flex gap-4"><button onclick="showAddClientForm()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ‘¤ Novo Cliente </button> <button onclick="sendBulkWhatsApp()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ“± WhatsApp em Massa </button>
       </div>
      </div><!-- Filtros CRM -->
      <div class="card-modern p-6 rounded-2xl mb-8">
       <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Buscar Cliente</label> <input type="text" id="client-search" placeholder="Nome ou empresa..." class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Tag</label> <select id="client-tag-filter" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="">Todas as tags</option> <option value="vip">VIP</option> <option value="recorrente">Recorrente</option> <option value="novo">Novo</option> <option value="inativo">Inativo</option> </select>
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">PerÃ­odo</label> <select id="client-period-filter" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="">Todo perÃ­odo</option> <option value="30">Ãšltimos 30 dias</option> <option value="90">Ãšltimos 90 dias</option> <option value="365">Ãšltimo ano</option> </select>
        </div>
        <div class="flex items-end"><button onclick="filterClients()" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ” Filtrar </button>
        </div>
       </div>
      </div><!-- Lista de Clientes -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="clients-grid"><!-- Clientes serÃ£o inseridos aqui dinamicamente -->
      </div><!-- Modal Adicionar Cliente -->
      <div id="add-client-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
       <div class="card-modern p-8 rounded-2xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
        <h3 class="text-2xl font-bold text-gray-900 mb-6">Novo Cliente</h3>
        <form id="client-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">Nome Completo</label> <input type="text" id="client-name" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
         </div>
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">Empresa</label> <input type="text" id="client-company" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
         </div>
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">WhatsApp</label> <input type="tel" id="client-whatsapp" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
         </div>
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">Email</label> <input type="email" id="client-email" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
         </div>
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">Tag</label> <select id="client-tag" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="novo">Novo</option> <option value="recorrente">Recorrente</option> <option value="vip">VIP</option> <option value="inativo">Inativo</option> </select>
         </div>
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">OrÃ§amento MÃ©dio</label> <input type="number" id="client-budget" step="0.01" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
         </div>
         <div class="md:col-span-2"><label class="block text-sm font-semibold text-gray-700 mb-2">ObservaÃ§Ãµes</label> <textarea id="client-notes" rows="3" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"></textarea>
         </div>
         <div class="md:col-span-2 flex gap-4"><button type="submit" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> Salvar Cliente </button> <button type="button" onclick="hideAddClientForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300"> Cancelar </button>
         </div>
        </form>
       </div>
      </div>
     </div>
    </div><!-- Dashboard Section -->
    <div id="dashboard-section" class="section">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 text-center">
       <h2 id="dashboard-title" class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Painel de Controle</h2>
       <p class="text-gray-600 text-lg">Acompanhe o desempenho da Trivaci em tempo real</p>
      </div><!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Receita Total</p>
           <p id="total-revenue" class="text-3xl font-bold text-gray-900">R$ 0,00</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ’°</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Vendas Este MÃªs</p>
           <p id="monthly-sales" class="text-3xl font-bold text-gray-900">0</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ“Š</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Perfis Vendidos</p>
           <p id="profiles-sold" class="text-3xl font-bold text-gray-900">0</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ‘¥</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">MÃ©dia por Venda</p>
           <p id="average-sale" class="text-3xl font-bold text-gray-900">R$ 0,00</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ“ˆ</span>
          </div>
         </div>
        </div>
       </div>
      </div><!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mr-3"></span> Receita por Status</h3>
        <canvas id="statusChart" width="400" height="200"></canvas>
       </div>
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mr-3"></span> DistribuiÃ§Ã£o por Categoria</h3>
        <canvas id="categoryChart" width="400" height="200"></canvas>
       </div>
      </div>
     </div>
    </div><!-- Marketplace Section -->
    <div id="marketplace-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 flex justify-between items-center">
       <div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Marketplace de Perfis</h2>
        <p class="text-gray-600 text-lg">Vitrine de perfis disponÃ­veis e sistema de leilÃµes</p>
       </div>
       <div class="flex gap-4"><button onclick="showAddMarketplaceItem()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸª Adicionar Ã  Vitrine </button> <button onclick="startAuction()" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ”¨ Iniciar LeilÃ£o </button>
       </div>
      </div><!-- Filtros Marketplace -->
      <div class="card-modern p-6 rounded-2xl mb-8">
       <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Categoria</label> <select id="marketplace-category-filter" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="">Todas</option> <option value="instagram">Instagram</option> <option value="tiktok">TikTok</option> <option value="youtube">YouTube</option> <option value="twitter">Twitter</option> </select>
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Seguidores Min</label> <input type="number" id="followers-min" placeholder="Ex: 10000" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Seguidores Max</label> <input type="number" id="followers-max" placeholder="Ex: 100000" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">PreÃ§o Max</label> <input type="number" id="price-max" placeholder="Ex: 5000" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div class="flex items-end"><button onclick="filterMarketplace()" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ” Filtrar </button>
        </div>
       </div>
      </div><!-- Calculadora de PreÃ§os -->
      <div class="card-modern p-8 rounded-2xl mb-8">
       <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-green-500 to-blue-500 rounded-full mr-3"></span> Calculadora de PreÃ§os Inteligente</h3>
       <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Seguidores</label> <input type="number" id="calc-followers" placeholder="Ex: 25000" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Engajamento (%)</label> <input type="number" id="calc-engagement" placeholder="Ex: 3.5" step="0.1" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-2">Nicho</label> <select id="calc-niche" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="1.0">Geral</option> <option value="1.2">Lifestyle</option> <option value="1.5">Fitness</option> <option value="1.8">NegÃ³cios</option> <option value="2.0">Tecnologia</option> </select>
        </div>
        <div class="flex items-end"><button onclick="calculatePrice()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ’° Calcular </button>
        </div>
       </div>
       <div id="price-result" class="mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 hidden">
        <h4 class="font-bold text-green-800 mb-2">PreÃ§o Sugerido</h4>
        <p class="text-2xl font-bold text-green-600" id="suggested-price">R$ 0</p>
        <p class="text-sm text-green-500 mt-1">Baseado em algoritmo de mercado</p>
       </div>
      </div><!-- Grid de Perfis -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="marketplace-grid"><!-- Perfis serÃ£o inseridos aqui dinamicamente -->
      </div>
     </div>
    </div><!-- Financeiro Section -->
    <div id="financeiro-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 flex justify-between items-center">
       <div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Controle Financeiro</h2>
        <p class="text-gray-600 text-lg">Fluxo de caixa, metas e anÃ¡lise de lucratividade</p>
       </div>
       <div class="flex gap-4"><button onclick="showAddGoalForm()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ¯ Nova Meta </button> <button onclick="exportFinancialReport()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105"> ğŸ“Š RelatÃ³rio </button>
       </div>
      </div><!-- Resumo Financeiro -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Receita Bruta</p>
           <p id="gross-revenue" class="text-3xl font-bold text-gray-900">R$ 0</p>
           <p id="gross-trend" class="text-sm text-green-600 mt-1">â†— +15.2% vs mÃªs anterior</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ’°</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">ComissÃµes Pagas</p>
           <p id="total-commissions" class="text-3xl font-bold text-gray-900">R$ 0</p>
           <p class="text-sm text-orange-600 mt-1">ğŸ“Š Total em comissÃµes</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ¤</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Receita LÃ­quida</p>
           <p id="net-revenue" class="text-3xl font-bold text-gray-900">R$ 0</p>
           <p class="text-sm text-blue-600 mt-1">ğŸ’ ApÃ³s comissÃµes</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ’</span>
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card card-modern overflow-hidden rounded-2xl">
        <div class="p-8">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Meta Mensal</p>
           <p id="monthly-goal" class="text-3xl font-bold text-gray-900">R$ 50.000</p>
           <p id="goal-progress" class="text-sm text-purple-600 mt-1">ğŸ¯ 65% atingido</p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center"><span class="text-2xl">ğŸ¯</span>
          </div>
         </div>
        </div>
       </div>
      </div><!-- GrÃ¡fico de Fluxo de Caixa -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-green-500 to-blue-500 rounded-full mr-3"></span> Fluxo de Caixa (6 meses)</h3>
        <canvas id="cashFlowChart" width="400" height="200"></canvas>
       </div>
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mr-3"></span> Lucratividade por Categoria</h3>
        <canvas id="profitabilityChart" width="400" height="200"></canvas>
       </div>
      </div><!-- Metas de Vendas -->
      <div class="card-modern p-8 rounded-2xl mb-8">
       <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mr-3"></span> Metas de Vendas</h3>
       <div class="space-y-6" id="goals-list"><!-- Metas serÃ£o inseridas aqui dinamicamente -->
       </div>
      </div>
     </div>
    </div><!-- ConfiguraÃ§Ãµes Section -->
    <div id="configuracoes-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10">
       <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">ConfiguraÃ§Ãµes</h2>
       <p class="text-gray-600 text-lg">Personalize sua experiÃªncia na Trivaci</p>
      </div><!-- ConfiguraÃ§Ãµes Gerais -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mr-3"></span> ConfiguraÃ§Ãµes Gerais</h3>
        <div class="space-y-6">
         <div><label class="flex items-center justify-between"> <span class="text-sm font-semibold text-gray-700">Modo Escuro</span> <input type="checkbox" id="dark-mode" class="toggle-switch"> </label>
         </div>
         <div><label class="flex items-center justify-between"> <span class="text-sm font-semibold text-gray-700">NotificaÃ§Ãµes Push</span> <input type="checkbox" id="notifications" class="toggle-switch" checked> </label>
         </div>
         <div><label class="flex items-center justify-between"> <span class="text-sm font-semibold text-gray-700">Backup AutomÃ¡tico</span> <input type="checkbox" id="auto-backup" class="toggle-switch" checked> </label>
         </div>
         <div><label class="block text-sm font-semibold text-gray-700 mb-2">Idioma</label> <select class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="pt-BR">PortuguÃªs (Brasil)</option> <option value="en-US">English (US)</option> <option value="es-ES">EspaÃ±ol</option> </select>
         </div>
        </div>
       </div>
       <div class="card-modern p-8 rounded-2xl">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-green-500 to-blue-500 rounded-full mr-3"></span> Atalhos de Teclado</h3>
        <div class="space-y-4">
         <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Nova venda</span> <kbd class="px-3 py-1 bg-gray-100 rounded-lg text-sm font-mono">Ctrl + N</kbd>
         </div>
         <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Busca global</span> <kbd class="px-3 py-1 bg-gray-100 rounded-lg text-sm font-mono">Ctrl + K</kbd>
         </div>
         <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Dashboard</span> <kbd class="px-3 py-1 bg-gray-100 rounded-lg text-sm font-mono">Ctrl + 1</kbd>
         </div>
         <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Analytics</span> <kbd class="px-3 py-1 bg-gray-100 rounded-lg text-sm font-mono">Ctrl + 2</kbd>
         </div>
         <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Exportar dados</span> <kbd class="px-3 py-1 bg-gray-100 rounded-lg text-sm font-mono">Ctrl + E</kbd>
         </div>
        </div>
       </div>
      </div><!-- AÃ§Ãµes RÃ¡pidas -->
      <div class="card-modern p-8 rounded-2xl mt-8">
       <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-3 h-3 bg-gradient-to-r from-orange-500 to-red-500 rounded-full mr-3"></span> AÃ§Ãµes RÃ¡pidas</h3>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><button onclick="exportAllData()" class="p-6 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl border border-blue-100 hover:shadow-lg transition-all duration-300">
         <div class="text-3xl mb-3">
          ğŸ“Š
         </div><h4 class="font-bold text-blue-800 mb-2">Exportar Todos os Dados</h4><p class="text-sm text-blue-600">Baixar CSV completo</p></button> <button onclick="generateBackup()" class="p-6 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-100 hover:shadow-lg transition-all duration-300">
         <div class="text-3xl mb-3">
          ğŸ’¾
         </div><h4 class="font-bold text-green-800 mb-2">Backup Manual</h4><p class="text-sm text-green-600">Salvar backup agora</p></button> <button onclick="resetAllData()" class="p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border border-red-100 hover:shadow-lg transition-all duration-300">
         <div class="text-3xl mb-3">
          ğŸ—‘ï¸
         </div><h4 class="font-bold text-red-800 mb-2">Limpar Dados</h4><p class="text-sm text-red-600">Remover todos os registros</p></button>
       </div>
      </div>
     </div>
    </div><!-- Publicidade Section -->
    <div id="publicidade-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 flex justify-between items-center">
       <div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">GestÃ£o de Publicidade</h2>
        <p class="text-gray-600 text-lg">Controle todas as campanhas publicitÃ¡rias da Trivaci</p>
       </div><button onclick="showAddPublicidadeForm()" class="trivaci-gradient-dark text-white px-8 py-4 rounded-2xl font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl"> âœ¨ Nova Campanha </button>
      </div><!-- Add Form -->
      <div id="add-publicidade-form" class="hidden card-modern p-8 rounded-2xl mb-8">
       <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mr-3"> <span class="text-white text-sm">ğŸ“¢</span> </span> Nova Campanha PublicitÃ¡ria</h3>
       <form id="publicidade-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div><label for="pub-client" class="block text-sm font-semibold text-gray-700 mb-2">Cliente</label> <input type="text" id="pub-client" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="pub-profile" class="block text-sm font-semibold text-gray-700 mb-2">Perfil/PÃ¡gina</label> <input type="text" id="pub-profile" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="pub-date" class="block text-sm font-semibold text-gray-700 mb-2">Data da Venda</label> <input type="date" id="pub-date" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="pub-value" class="block text-sm font-semibold text-gray-700 mb-2">Valor (R$)</label> <input type="number" id="pub-value" step="0.01" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="pub-fee" class="block text-sm font-semibold text-gray-700 mb-2">Taxa (%)</label> <input type="number" id="pub-fee" step="0.01" min="0" max="100" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="pub-status" class="block text-sm font-semibold text-gray-700 mb-2">Status</label> <select id="pub-status" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="ativo">Ativo</option> <option value="concluido">ConcluÃ­do</option> <option value="cancelado">Cancelado</option> </select>
        </div>
        <div class="md:col-span-2 flex gap-4"><button type="submit" id="pub-submit-btn" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105 flex items-center gap-3"> <span id="pub-submit-text">Salvar Campanha</span>
          <div id="pub-loading" class="loading-spinner hidden"></div></button> <button type="button" onclick="hideAddPublicidadeForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300"> Cancelar </button>
        </div>
       </form>
      </div><!-- Publicidade List -->
      <div class="card-modern shadow-xl rounded-2xl overflow-hidden">
       <div class="px-8 py-6 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-purple-100">
        <h3 class="text-xl font-bold text-gray-900">Campanhas PublicitÃ¡rias</h3>
       </div>
       <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-purple-100">
         <thead class="bg-gradient-to-r from-purple-50 to-pink-50">
          <tr>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Cliente</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Perfil</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Data</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Valor</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Taxa</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Valor Final</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Status</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">AÃ§Ãµes</th>
          </tr>
         </thead>
         <tbody id="publicidade-list" class="bg-white divide-y divide-purple-50">
          <tr>
           <td colspan="8" class="px-6 py-8 text-center text-gray-500">Nenhuma campanha cadastrada ainda</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div><!-- Trading Section -->
    <div id="trading-section" class="section hidden">
     <div class="px-4 py-6 sm:px-0">
      <div class="mb-10 flex justify-between items-center">
       <div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Trading de Perfis</h2>
        <p class="text-gray-600 text-lg">Gerencie a compra e venda de perfis sociais</p>
       </div><button onclick="showAddTradingForm()" class="trivaci-gradient-dark text-white px-8 py-4 rounded-2xl font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl"> ğŸ’ Nova Venda </button>
      </div><!-- Add Form -->
      <div id="add-trading-form" class="hidden card-modern p-8 rounded-2xl mb-8">
       <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center"><span class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mr-3"> <span class="text-white text-sm">ğŸ’</span> </span> Nova Venda de Perfil</h3>
       <form id="trading-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div><label for="trade-username" class="block text-sm font-semibold text-gray-700 mb-2">Nome de UsuÃ¡rio</label> <input type="text" id="trade-username" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="trade-followers" class="block text-sm font-semibold text-gray-700 mb-2">Seguidores</label> <input type="number" id="trade-followers" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="trade-date" class="block text-sm font-semibold text-gray-700 mb-2">Data da Venda</label> <input type="date" id="trade-date" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="trade-value" class="block text-sm font-semibold text-gray-700 mb-2">Valor de Venda (R$)</label> <input type="number" id="trade-value" step="0.01" required class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
        </div>
        <div><label for="trade-category" class="block text-sm font-semibold text-gray-700 mb-2">Categoria</label> <select id="trade-category" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="instagram">Instagram</option> <option value="tiktok">TikTok</option> <option value="youtube">YouTube</option> <option value="twitter">Twitter</option> <option value="facebook">Facebook</option> </select>
        </div>
        <div><label for="trade-status" class="block text-sm font-semibold text-gray-700 mb-2">Status</label> <select id="trade-status" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"> <option value="vendido">Vendido</option> <option value="negociando">Negociando</option> <option value="disponivel">DisponÃ­vel</option> </select>
        </div>
        <div class="md:col-span-2 flex gap-4"><button type="submit" id="trade-submit-btn" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105 flex items-center gap-3"> <span id="trade-submit-text">Salvar Venda</span>
          <div id="trade-loading" class="loading-spinner hidden"></div></button> <button type="button" onclick="hideAddTradingForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300"> Cancelar </button>
        </div>
       </form>
      </div><!-- Trading List -->
      <div class="card-modern shadow-xl rounded-2xl overflow-hidden">
       <div class="px-8 py-6 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-purple-100">
        <h3 class="text-xl font-bold text-gray-900">Perfis Negociados</h3>
       </div>
       <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-purple-100">
         <thead class="bg-gradient-to-r from-purple-50 to-pink-50">
          <tr>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">UsuÃ¡rio</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Seguidores</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Categoria</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Data</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Valor</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Status</th>
           <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">AÃ§Ãµes</th>
          </tr>
         </thead>
         <tbody id="trading-list" class="bg-white divide-y divide-purple-50">
          <tr>
           <td colspan="7" class="px-6 py-8 text-center text-gray-500">Nenhum perfil cadastrado ainda</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
        // Global variables
        let allData = [];
        let statusChart = null;
        let categoryChart = null;
        let trendsChart = null;
        let platformChart = null;
        let cashFlowChart = null;
        let profitabilityChart = null;
        let currentRecordCount = 0;
        let clientsData = [];
        let goalsData = [];
        let marketplaceData = [];

        // Default configuration
        const defaultConfig = {
            agency_name: "TRIVACI",
            dashboard_title: "Painel de Controle",
            currency_symbol: "R$",
            primary_color: "#8B5CF6",
            secondary_color: "#A855F7",
            background_color: "#FEFCFF",
            text_color: "#1F2937",
            accent_color: "#E879F9"
        };

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                currentRecordCount = data.length;
                updateDashboard();
                updatePublicidadeList();
                updateTradingList();
            }
        };

        // Initialize SDKs
        async function initializeApp() {
            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.init(enhancedDataHandler);
                    if (!result.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }

                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            document.getElementById('agency-name').textContent = config.agency_name || defaultConfig.agency_name;
                            document.getElementById('dashboard-title').textContent = config.dashboard_title || defaultConfig.dashboard_title;
                            
                            // Apply colors
                            const primaryColor = config.primary_color || defaultConfig.primary_color;
                            const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
                            const backgroundColor = config.background_color || defaultConfig.background_color;
                            const textColor = config.text_color || defaultConfig.text_color;
                            const accentColor = config.accent_color || defaultConfig.accent_color;
                            
                            document.body.style.backgroundColor = backgroundColor;
                            document.body.style.color = textColor;
                            
                            // Update gradient backgrounds
                            const trivaciBg = document.querySelectorAll('.trivaci-gradient');
                            trivaciBg.forEach(el => {
                                el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 25%, ${accentColor} 50%, #E879F9 75%, #F0ABFC 100%)`;
                            });
                            
                            const trivaciDarkBg = document.querySelectorAll('.trivaci-gradient-dark');
                            trivaciDarkBg.forEach(el => {
                                el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 50%, ${accentColor} 100%)`;
                            });
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [
                                {
                                    get: () => config.primary_color || defaultConfig.primary_color,
                                    set: (value) => {
                                        if (window.elementSdk) {
                                            window.elementSdk.setConfig({ primary_color: value });
                                        }
                                    }
                                },
                                {
                                    get: () => config.secondary_color || defaultConfig.secondary_color,
                                    set: (value) => {
                                        if (window.elementSdk) {
                                            window.elementSdk.setConfig({ secondary_color: value });
                                        }
                                    }
                                },
                                {
                                    get: () => config.background_color || defaultConfig.background_color,
                                    set: (value) => {
                                        if (window.elementSdk) {
                                            window.elementSdk.setConfig({ background_color: value });
                                        }
                                    }
                                },
                                {
                                    get: () => config.text_color || defaultConfig.text_color,
                                    set: (value) => {
                                        if (window.elementSdk) {
                                            window.elementSdk.setConfig({ text_color: value });
                                        }
                                    }
                                },
                                {
                                    get: () => config.accent_color || defaultConfig.accent_color,
                                    set: (value) => {
                                        if (window.elementSdk) {
                                            window.elementSdk.setConfig({ accent_color: value });
                                        }
                                    }
                                }
                            ],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["agency_name", config.agency_name || defaultConfig.agency_name],
                            ["dashboard_title", config.dashboard_title || defaultConfig.dashboard_title],
                            ["currency_symbol", config.currency_symbol || defaultConfig.currency_symbol]
                        ])
                    });
                }

                initializeCharts();
                initializeAdvancedCharts();
                initializeFinancialCharts();
                updateClientsGrid();
                
                // Set default active section
                showSection('dashboard');
            } catch (error) {
                console.error("Error initializing app:", error);
            }
        }

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-btn-active');
            });
            
            // Find and activate the clicked button
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(sectionName)) {
                    btn.classList.add('nav-btn-active');
                }
            });
        }

        // Dashboard functions
        function updateDashboard() {
            const publicidadeData = allData.filter(item => item.type === 'publicidade');
            const tradingData = allData.filter(item => item.type === 'trading');
            
            const totalRevenue = allData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlySales = allData.filter(item => {
                const itemDate = new Date(item.sale_date);
                return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
            }).length;
            
            const profilesSold = tradingData.filter(item => item.status === 'vendido').length;
            const averageSale = allData.length > 0 ? totalRevenue / allData.length : 0;
            
            document.getElementById('total-revenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('monthly-sales').textContent = monthlySales;
            document.getElementById('profiles-sold').textContent = profilesSold;
            document.getElementById('average-sale').textContent = formatCurrency(averageSale);
            
            updateCharts();
        }

        function formatCurrency(value) {
            const symbol = window.elementSdk?.config?.currency_symbol || defaultConfig.currency_symbol;
            return `${symbol} ${value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        function initializeCharts() {
            const ctx1 = document.getElementById('statusChart').getContext('2d');
            const ctx2 = document.getElementById('categoryChart').getContext('2d');
            
            statusChart = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: ['Ativo/Vendido', 'ConcluÃ­do', 'Negociando', 'DisponÃ­vel', 'Cancelado'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#10B981', // Verde para ativo/vendido
                            '#3B82F6', // Azul para concluÃ­do
                            '#F59E0B', // Amarelo para negociando
                            '#8B5CF6', // Roxo para disponÃ­vel
                            '#EF4444'  // Vermelho para cancelado
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 15,
                        hoverBorderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            categoryChart = new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: ['Publicidade', 'Instagram', 'TikTok', 'YouTube', 'Twitter', 'Facebook'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#8B5CF6', // Roxo para publicidade
                            '#E1306C', // Rosa para Instagram
                            '#000000', // Preto para TikTok
                            '#FF0000', // Vermelho para YouTube
                            '#1DA1F2', // Azul para Twitter
                            '#1877F2'  // Azul Facebook
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 15,
                        hoverBorderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.parsed / total) * 100).toFixed(1) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if (!statusChart || !categoryChart) return;
            
            // Status chart - agrupa por status
            const statusData = {
                'ativo': 0,
                'vendido': 0,
                'concluido': 0,
                'negociando': 0,
                'disponivel': 0,
                'cancelado': 0
            };
            
            allData.forEach(item => {
                const value = item.final_value || item.value || 0;
                if (item.status === 'ativo' || item.status === 'vendido') {
                    statusData['ativo'] += value;
                } else if (statusData.hasOwnProperty(item.status)) {
                    statusData[item.status] += value;
                }
            });
            
            statusChart.data.datasets[0].data = [
                statusData.ativo + statusData.vendido,
                statusData.concluido,
                statusData.negociando,
                statusData.disponivel,
                statusData.cancelado
            ];
            statusChart.update();
            
            // Category chart - separa publicidade das redes sociais
            const categoryData = {
                'publicidade': 0,
                'instagram': 0,
                'tiktok': 0,
                'youtube': 0,
                'twitter': 0,
                'facebook': 0
            };
            
            allData.forEach(item => {
                const value = item.final_value || item.value || 0;
                if (item.type === 'publicidade') {
                    categoryData.publicidade += value;
                } else if (categoryData.hasOwnProperty(item.category)) {
                    categoryData[item.category] += value;
                }
            });
            
            categoryChart.data.datasets[0].data = [
                categoryData.publicidade,
                categoryData.instagram,
                categoryData.tiktok,
                categoryData.youtube,
                categoryData.twitter,
                categoryData.facebook
            ];
            categoryChart.update();
        }

        // Publicidade functions
        function showAddPublicidadeForm() {
            document.getElementById('add-publicidade-form').classList.remove('hidden');
            document.getElementById('pub-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('pub-client').focus();
        }

        function hideAddPublicidadeForm() {
            document.getElementById('add-publicidade-form').classList.add('hidden');
            document.getElementById('publicidade-form').reset();
        }

        async function handlePublicidadeSubmit(event) {
            event.preventDefault();
            
            if (currentRecordCount >= 999) {
                showToast("Limite mÃ¡ximo de 999 registros atingido. Exclua alguns itens primeiro.", "error");
                return;
            }
            
            const submitBtn = document.getElementById('pub-submit-btn');
            const submitText = document.getElementById('pub-submit-text');
            const loading = document.getElementById('pub-loading');
            
            // ValidaÃ§Ã£o dos campos
            const clientName = document.getElementById('pub-client').value.trim();
            const profileName = document.getElementById('pub-profile').value.trim();
            const value = parseFloat(document.getElementById('pub-value').value);
            const saleDate = document.getElementById('pub-date').value;
            
            if (!clientName || !profileName || !value || !saleDate) {
                showToast("Por favor, preencha todos os campos obrigatÃ³rios.", "error");
                return;
            }
            
            if (value <= 0) {
                showToast("O valor deve ser maior que zero.", "error");
                return;
            }
            
            submitBtn.disabled = true;
            submitText.textContent = 'Salvando...';
            loading.classList.remove('hidden');
            
            const feePercentage = parseFloat(document.getElementById('pub-fee').value) || 0;
            const hasFee = feePercentage > 0;
            const finalValue = hasFee ? value - (value * feePercentage / 100) : value;
            
            const record = {
                id: Date.now().toString(),
                type: 'publicidade',
                client_name: clientName,
                profile_username: profileName,
                sale_date: saleDate,
                value: value,
                has_fee: hasFee,
                fee_percentage: feePercentage,
                final_value: finalValue,
                status: document.getElementById('pub-status').value,
                category: 'publicidade',
                followers: 0,
                created_at: new Date().toISOString()
            };
            
            if (window.dataSdk) {
                const result = await window.dataSdk.create(record);
                if (result.isOk) {
                    hideAddPublicidadeForm();
                    showToast("Campanha publicitÃ¡ria salva com sucesso! ğŸ‰", "success");
                } else {
                    showToast("Erro ao salvar campanha. Tente novamente.", "error");
                }
            }
            
            submitBtn.disabled = false;
            submitText.textContent = 'Salvar Campanha';
            loading.classList.add('hidden');
        }

        function updatePublicidadeList() {
            const publicidadeData = allData.filter(item => item.type === 'publicidade');
            const tbody = document.getElementById('publicidade-list');
            
            if (publicidadeData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="px-6 py-8 text-center text-gray-500">Nenhuma campanha cadastrada ainda</td></tr>';
                return;
            }
            
            tbody.innerHTML = publicidadeData.map(item => `
                <tr class="hover:bg-purple-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">${item.client_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.profile_username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${formatDate(item.sale_date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${formatCurrency(item.value)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.fee_percentage}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600">${formatCurrency(item.final_value)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(item.status)}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="deleteRecord('${item.__backendId}')" class="text-red-500 hover:text-red-700 font-semibold transition-colors">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        // Trading functions
        function showAddTradingForm() {
            document.getElementById('add-trading-form').classList.remove('hidden');
            document.getElementById('trade-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('trade-username').focus();
        }

        function hideAddTradingForm() {
            document.getElementById('add-trading-form').classList.add('hidden');
            document.getElementById('trading-form').reset();
        }

        async function handleTradingSubmit(event) {
            event.preventDefault();
            
            if (currentRecordCount >= 999) {
                showToast("Limite mÃ¡ximo de 999 registros atingido. Exclua alguns itens primeiro.", "error");
                return;
            }
            
            const submitBtn = document.getElementById('trade-submit-btn');
            const submitText = document.getElementById('trade-submit-text');
            const loading = document.getElementById('trade-loading');
            
            // ValidaÃ§Ã£o dos campos
            const username = document.getElementById('trade-username').value.trim();
            const followers = parseInt(document.getElementById('trade-followers').value);
            const value = parseFloat(document.getElementById('trade-value').value);
            const saleDate = document.getElementById('trade-date').value;
            
            if (!username || !followers || !value || !saleDate) {
                showToast("Por favor, preencha todos os campos obrigatÃ³rios.", "error");
                return;
            }
            
            if (followers <= 0) {
                showToast("O nÃºmero de seguidores deve ser maior que zero.", "error");
                return;
            }
            
            if (value <= 0) {
                showToast("O valor de venda deve ser maior que zero.", "error");
                return;
            }
            
            // Remove @ do username se existir
            const cleanUsername = username.replace('@', '');
            
            submitBtn.disabled = true;
            submitText.textContent = 'Salvando...';
            loading.classList.remove('hidden');
            
            const record = {
                id: Date.now().toString(),
                type: 'trading',
                client_name: '',
                profile_username: cleanUsername,
                sale_date: saleDate,
                value: value,
                followers: followers,
                has_fee: false,
                fee_percentage: 0,
                final_value: value,
                status: document.getElementById('trade-status').value,
                category: document.getElementById('trade-category').value,
                created_at: new Date().toISOString()
            };
            
            if (window.dataSdk) {
                const result = await window.dataSdk.create(record);
                if (result.isOk) {
                    hideAddTradingForm();
                    showToast("Venda de perfil registrada com sucesso! ğŸ’", "success");
                } else {
                    showToast("Erro ao salvar venda. Tente novamente.", "error");
                }
            }
            
            submitBtn.disabled = false;
            submitText.textContent = 'Salvar Venda';
            loading.classList.add('hidden');
        }

        function updateTradingList() {
            const tradingData = allData.filter(item => item.type === 'trading');
            const tbody = document.getElementById('trading-list');
            
            if (tradingData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-8 text-center text-gray-500">Nenhum perfil cadastrado ainda</td></tr>';
                return;
            }
            
            tbody.innerHTML = tradingData.map(item => `
                <tr class="hover:bg-purple-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">@${item.profile_username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.followers.toLocaleString('pt-BR')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 capitalize">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${formatDate(item.sale_date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600">${formatCurrency(item.value)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(item.status)}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="deleteRecord('${item.__backendId}')" class="text-red-500 hover:text-red-700 font-semibold transition-colors">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        // Utility functions
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        function getStatusColor(status) {
            const colors = {
                'ativo': 'bg-green-100 text-green-800',
                'concluido': 'bg-blue-100 text-blue-800',
                'cancelado': 'bg-red-100 text-red-800',
                'vendido': 'bg-green-100 text-green-800',
                'negociando': 'bg-yellow-100 text-yellow-800',
                'disponivel': 'bg-purple-100 text-purple-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        async function deleteRecord(backendId) {
            const record = allData.find(item => item.__backendId === backendId);
            if (!record) return;
            
            // ConfirmaÃ§Ã£o inline
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Confirmar?';
            button.className = 'text-red-600 hover:text-red-800 font-bold transition-colors bg-red-50 px-3 py-1 rounded-lg';
            
            // Timeout para reverter se nÃ£o confirmar
            const timeout = setTimeout(() => {
                button.textContent = originalText;
                button.className = 'text-red-500 hover:text-red-700 font-semibold transition-colors';
            }, 3000);
            
            // Novo evento de clique para confirmaÃ§Ã£o
            const confirmHandler = async (e) => {
                e.stopPropagation();
                clearTimeout(timeout);
                button.removeEventListener('click', confirmHandler);
                
                button.textContent = 'Excluindo...';
                button.disabled = true;
                
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(record);
                    if (result.isOk) {
                        showToast("Registro excluÃ­do com sucesso! âœ…", "success");
                    } else {
                        showToast("Erro ao excluir registro. Tente novamente.", "error");
                        button.textContent = originalText;
                        button.className = 'text-red-500 hover:text-red-700 font-semibold transition-colors';
                        button.disabled = false;
                    }
                }
            };
            
            button.addEventListener('click', confirmHandler);
        }

        // FunÃ§Ã£o para calcular estatÃ­sticas avanÃ§adas
        function calculateAdvancedStats() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // Dados do mÃªs atual
            const currentMonthData = allData.filter(item => {
                const itemDate = new Date(item.sale_date);
                return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
            });
            
            // Dados do mÃªs passado
            const lastMonthData = allData.filter(item => {
                const itemDate = new Date(item.sale_date);
                return itemDate.getMonth() === lastMonth && itemDate.getFullYear() === lastMonthYear;
            });
            
            const currentMonthRevenue = currentMonthData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            const lastMonthRevenue = lastMonthData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            
            const growthPercentage = lastMonthRevenue > 0 ? 
                ((currentMonthRevenue - lastMonthRevenue) / lastMonthRevenue * 100).toFixed(1) : 0;
            
            return {
                currentMonthRevenue,
                lastMonthRevenue,
                growthPercentage,
                currentMonthSales: currentMonthData.length,
                lastMonthSales: lastMonthData.length
            };
        }

        // FunÃ§Ã£o para exportar dados (simulaÃ§Ã£o)
        function exportData() {
            if (allData.length === 0) {
                showToast("NÃ£o hÃ¡ dados para exportar.", "error");
                return;
            }
            
            const csvContent = generateCSV();
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `trivaci_dados_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast("Dados exportados com sucesso! ğŸ“Š", "success");
            }
        }

        function generateCSV() {
            const headers = ['Tipo', 'Cliente', 'Perfil', 'Data', 'Valor', 'Taxa %', 'Valor Final', 'Seguidores', 'Categoria', 'Status'];
            const rows = allData.map(item => [
                item.type,
                item.client_name || '',
                item.profile_username,
                item.sale_date,
                item.value,
                item.fee_percentage || 0,
                item.final_value || item.value,
                item.followers || 0,
                item.category,
                item.status
            ]);
            
            return [headers, ...rows].map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `fixed top-6 right-6 px-8 py-4 rounded-2xl text-white font-semibold z-50 shadow-2xl transform transition-all duration-300 ${
                type === 'success' ? 'bg-gradient-to-r from-green-500 to-green-600' : 'bg-gradient-to-r from-red-500 to-red-600'
            }`;
            toast.textContent = message;
            toast.style.transform = 'translateX(100%)';
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Event listeners
        document.getElementById('publicidade-form').addEventListener('submit', handlePublicidadeSubmit);
        document.getElementById('trading-form').addEventListener('submit', handleTradingSubmit);

        // Analytics Functions
        function updateAnalytics() {
            const totalRevenue = allData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            const totalSales = allData.length;
            
            // ROI Calculation (simplified)
            const avgROI = totalSales > 0 ? ((totalRevenue / totalSales) * 0.3).toFixed(1) : 0;
            document.getElementById('avg-roi').textContent = `${avgROI}%`;
            
            // Conversion Rate (simplified)
            const conversionRate = totalSales > 0 ? (totalSales * 2.5).toFixed(1) : 0;
            document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
            
            // Average Ticket
            const avgTicket = totalSales > 0 ? totalRevenue / totalSales : 0;
            document.getElementById('avg-ticket').textContent = formatCurrency(avgTicket);
            
            // Monthly Forecast (AI simulation)
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const currentMonthData = allData.filter(item => {
                const itemDate = new Date(item.sale_date);
                return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
            });
            const currentMonthRevenue = currentMonthData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const currentDay = new Date().getDate();
            const forecast = (currentMonthRevenue / currentDay) * daysInMonth;
            document.getElementById('monthly-forecast').textContent = formatCurrency(forecast);
            
            updateAdvancedCharts();
        }

        function updateAdvancedCharts() {
            if (trendsChart) {
                // Generate 6 months of trend data
                const months = [];
                const revenues = [];
                for (let i = 5; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    months.push(date.toLocaleDateString('pt-BR', { month: 'short' }));
                    
                    const monthRevenue = allData.filter(item => {
                        const itemDate = new Date(item.sale_date);
                        return itemDate.getMonth() === date.getMonth() && itemDate.getFullYear() === date.getFullYear();
                    }).reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
                    
                    revenues.push(monthRevenue);
                }
                
                trendsChart.data.labels = months;
                trendsChart.data.datasets[0].data = revenues;
                trendsChart.update();
            }
            
            if (platformChart) {
                const platformData = {
                    'Instagram': 0,
                    'TikTok': 0,
                    'YouTube': 0,
                    'Twitter': 0,
                    'Facebook': 0
                };
                
                allData.forEach(item => {
                    const value = item.final_value || item.value || 0;
                    if (item.category && platformData.hasOwnProperty(item.category.charAt(0).toUpperCase() + item.category.slice(1))) {
                        platformData[item.category.charAt(0).toUpperCase() + item.category.slice(1)] += value;
                    }
                });
                
                platformChart.data.datasets[0].data = Object.values(platformData);
                platformChart.update();
            }
        }

        function initializeAdvancedCharts() {
            // Trends Chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Receita Mensal',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
            
            // Platform Performance Chart
            const platformCtx = document.getElementById('platformChart').getContext('2d');
            platformChart = new Chart(platformCtx, {
                type: 'bar',
                data: {
                    labels: ['Instagram', 'TikTok', 'YouTube', 'Twitter', 'Facebook'],
                    datasets: [{
                        label: 'Performance',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#E1306C',
                            '#000000',
                            '#FF0000',
                            '#1DA1F2',
                            '#1877F2'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        function exportAnalytics() {
            const analyticsData = {
                totalRevenue: allData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0),
                totalSales: allData.length,
                avgTicket: allData.length > 0 ? allData.reduce((sum, item) => sum + (item.final_value || item.value || 0), 0) / allData.length : 0,
                platformBreakdown: {},
                monthlyTrends: {}
            };
            
            const csvContent = `RelatÃ³rio Analytics Trivaci\nData: ${new Date().toLocaleDateString('pt-BR')}\n\nReceita Total: R$ ${analyticsData.totalRevenue.toLocaleString('pt-BR')}\nVendas Totais: ${analyticsData.totalSales}\nTicket MÃ©dio: R$ ${analyticsData.avgTicket.toLocaleString('pt-BR')}`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `trivaci_analytics_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("RelatÃ³rio de analytics exportado com sucesso! ğŸ“Š", "success");
        }

        function generateForecast() {
            const currentMonthRevenue = allData.filter(item => {
                const itemDate = new Date(item.sale_date);
                const now = new Date();
                return itemDate.getMonth() === now.getMonth() && itemDate.getFullYear() === now.getFullYear();
            }).reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            
            const daysInMonth = new Date().getDate();
            const avgDailyRevenue = currentMonthRevenue / daysInMonth;
            const remainingDays = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate() - daysInMonth;
            const projectedRevenue = currentMonthRevenue + (avgDailyRevenue * remainingDays);
            
            showToast(`PrevisÃ£o IA: R$ ${projectedRevenue.toLocaleString('pt-BR')} atÃ© o fim do mÃªs! ğŸ”®`, "success");
        }

        // CRM Functions
        function showAddClientForm() {
            document.getElementById('add-client-modal').classList.remove('hidden');
            document.getElementById('client-name').focus();
        }

        function hideAddClientForm() {
            document.getElementById('add-client-modal').classList.add('hidden');
            document.getElementById('client-form').reset();
        }

        async function handleClientSubmit(event) {
            event.preventDefault();
            
            const clientData = {
                id: Date.now().toString(),
                type: 'client',
                name: document.getElementById('client-name').value.trim(),
                company: document.getElementById('client-company').value.trim(),
                whatsapp: document.getElementById('client-whatsapp').value.trim(),
                email: document.getElementById('client-email').value.trim(),
                tag: document.getElementById('client-tag').value,
                budget: parseFloat(document.getElementById('client-budget').value) || 0,
                notes: document.getElementById('client-notes').value.trim(),
                created_at: new Date().toISOString()
            };
            
            clientsData.push(clientData);
            updateClientsGrid();
            hideAddClientForm();
            showToast("Cliente adicionado com sucesso! ğŸ‘¤", "success");
        }

        function updateClientsGrid() {
            const grid = document.getElementById('clients-grid');
            
            if (clientsData.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">Nenhum cliente cadastrado ainda</div>';
                return;
            }
            
            grid.innerHTML = clientsData.map(client => `
                <div class="card-modern p-6 rounded-2xl hover:shadow-lg transition-all duration-300">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-gray-900 text-lg">${client.name}</h4>
                            ${client.company ? `<p class="text-gray-600 text-sm">${client.company}</p>` : ''}
                        </div>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${getTagColor(client.tag)}">
                            ${client.tag}
                        </span>
                    </div>
                    <div class="space-y-2 mb-4">
                        ${client.whatsapp ? `<p class="text-sm text-gray-600">ğŸ“± ${client.whatsapp}</p>` : ''}
                        ${client.email ? `<p class="text-sm text-gray-600">âœ‰ï¸ ${client.email}</p>` : ''}
                        ${client.budget > 0 ? `<p class="text-sm text-gray-600">ğŸ’° OrÃ§amento: ${formatCurrency(client.budget)}</p>` : ''}
                    </div>
                    ${client.notes ? `<p class="text-sm text-gray-500 mb-4">${client.notes}</p>` : ''}
                    <div class="flex gap-2">
                        <button onclick="sendWhatsApp('${client.whatsapp}')" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                            WhatsApp
                        </button>
                        <button onclick="generateProposal('${client.id}')" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                            Proposta
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getTagColor(tag) {
            const colors = {
                'vip': 'bg-yellow-100 text-yellow-800',
                'recorrente': 'bg-green-100 text-green-800',
                'novo': 'bg-blue-100 text-blue-800',
                'inativo': 'bg-gray-100 text-gray-800'
            };
            return colors[tag] || 'bg-gray-100 text-gray-800';
        }

        function filterClients() {
            // Implementar filtros de clientes
            showToast("Filtros aplicados! ğŸ”", "success");
        }

        function sendWhatsApp(phone) {
            if (phone) {
                const message = encodeURIComponent("OlÃ¡! Entrando em contato da Trivaci Digital Agency. Como posso ajudÃ¡-lo?");
                window.open(`https://wa.me/${phone.replace(/\D/g, '')}?text=${message}`, '_blank', 'noopener,noreferrer');
            }
        }

        function sendBulkWhatsApp() {
            showToast("Funcionalidade de WhatsApp em massa em desenvolvimento! ğŸ“±", "success");
        }

        function generateProposal(clientId) {
            showToast("Proposta automÃ¡tica gerada! ğŸ“„", "success");
        }

        // Marketplace Functions
        function showAddMarketplaceItem() {
            showToast("Adicionar perfil Ã  vitrine - funcionalidade em desenvolvimento! ğŸª", "success");
        }

        function startAuction() {
            showToast("Sistema de leilÃ£o iniciado! ğŸ”¨", "success");
        }

        function filterMarketplace() {
            showToast("Filtros do marketplace aplicados! ğŸ”", "success");
        }

        function calculatePrice() {
            const followers = parseInt(document.getElementById('calc-followers').value) || 0;
            const engagement = parseFloat(document.getElementById('calc-engagement').value) || 0;
            const niche = parseFloat(document.getElementById('calc-niche').value) || 1.0;
            
            if (followers === 0) {
                showToast("Por favor, insira o nÃºmero de seguidores!", "error");
                return;
            }
            
            // Algoritmo de precificaÃ§Ã£o
            const basePrice = followers * 0.12; // R$ 0.12 por seguidor
            const engagementMultiplier = Math.max(0.5, engagement / 3.0); // Normalizar engajamento
            const finalPrice = basePrice * engagementMultiplier * niche;
            
            document.getElementById('suggested-price').textContent = formatCurrency(finalPrice);
            document.getElementById('price-result').classList.remove('hidden');
            
            showToast("PreÃ§o calculado com sucesso! ğŸ’°", "success");
        }

        // Financial Functions
        function updateFinancialData() {
            const grossRevenue = allData.reduce((sum, item) => sum + (item.value || 0), 0);
            const totalCommissions = allData.reduce((sum, item) => sum + ((item.value || 0) * (item.fee_percentage || 0) / 100), 0);
            const netRevenue = grossRevenue - totalCommissions;
            
            document.getElementById('gross-revenue').textContent = formatCurrency(grossRevenue);
            document.getElementById('total-commissions').textContent = formatCurrency(totalCommissions);
            document.getElementById('net-revenue').textContent = formatCurrency(netRevenue);
            
            // Update goal progress
            const monthlyGoal = 50000; // R$ 50.000 meta padrÃ£o
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const currentMonthRevenue = allData.filter(item => {
                const itemDate = new Date(item.sale_date);
                return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
            }).reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
            
            const goalProgress = (currentMonthRevenue / monthlyGoal * 100).toFixed(0);
            document.getElementById('goal-progress').textContent = `ğŸ¯ ${goalProgress}% atingido`;
            
            updateFinancialCharts();
        }

        function updateFinancialCharts() {
            if (cashFlowChart) {
                // Generate cash flow data
                const months = [];
                const revenues = [];
                for (let i = 5; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    months.push(date.toLocaleDateString('pt-BR', { month: 'short' }));
                    
                    const monthRevenue = allData.filter(item => {
                        const itemDate = new Date(item.sale_date);
                        return itemDate.getMonth() === date.getMonth() && itemDate.getFullYear() === date.getFullYear();
                    }).reduce((sum, item) => sum + (item.final_value || item.value || 0), 0);
                    
                    revenues.push(monthRevenue);
                }
                
                cashFlowChart.data.labels = months;
                cashFlowChart.data.datasets[0].data = revenues;
                cashFlowChart.update();
            }
            
            if (profitabilityChart) {
                const categoryProfits = {
                    'Publicidade': 0,
                    'Instagram': 0,
                    'TikTok': 0,
                    'YouTube': 0,
                    'Twitter': 0
                };
                
                allData.forEach(item => {
                    const profit = (item.final_value || item.value || 0) * 0.7; // 70% profit margin
                    if (item.type === 'publicidade') {
                        categoryProfits['Publicidade'] += profit;
                    } else if (categoryProfits.hasOwnProperty(item.category?.charAt(0).toUpperCase() + item.category?.slice(1))) {
                        categoryProfits[item.category.charAt(0).toUpperCase() + item.category.slice(1)] += profit;
                    }
                });
                
                profitabilityChart.data.datasets[0].data = Object.values(categoryProfits);
                profitabilityChart.update();
            }
        }

        function initializeFinancialCharts() {
            // Cash Flow Chart
            const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d');
            cashFlowChart = new Chart(cashFlowCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Fluxo de Caixa',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
            
            // Profitability Chart
            const profitabilityCtx = document.getElementById('profitabilityChart').getContext('2d');
            profitabilityChart = new Chart(profitabilityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Publicidade', 'Instagram', 'TikTok', 'YouTube', 'Twitter'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#8B5CF6',
                            '#E1306C',
                            '#000000',
                            '#FF0000',
                            '#1DA1F2'
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function showAddGoalForm() {
            showToast("Adicionar nova meta - funcionalidade em desenvolvimento! ğŸ¯", "success");
        }

        function exportFinancialReport() {
            const grossRevenue = allData.reduce((sum, item) => sum + (item.value || 0), 0);
            const totalCommissions = allData.reduce((sum, item) => sum + ((item.value || 0) * (item.fee_percentage || 0) / 100), 0);
            const netRevenue = grossRevenue - totalCommissions;
            
            const reportContent = `RelatÃ³rio Financeiro Trivaci\nData: ${new Date().toLocaleDateString('pt-BR')}\n\nReceita Bruta: R$ ${grossRevenue.toLocaleString('pt-BR')}\nComissÃµes Pagas: R$ ${totalCommissions.toLocaleString('pt-BR')}\nReceita LÃ­quida: R$ ${netRevenue.toLocaleString('pt-BR')}`;
            
            const blob = new Blob([reportContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `trivaci_financeiro_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("RelatÃ³rio financeiro exportado! ğŸ“Š", "success");
        }

        // Configuration Functions
        function exportAllData() {
            if (allData.length === 0) {
                showToast("NÃ£o hÃ¡ dados para exportar.", "error");
                return;
            }
            
            const csvContent = generateCSV();
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `trivaci_completo_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("Dados completos exportados! ğŸ“Š", "success");
        }

        function generateBackup() {
            const backupData = {
                sales: allData,
                clients: clientsData,
                goals: goalsData,
                marketplace: marketplaceData,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `trivaci_backup_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("Backup gerado com sucesso! ğŸ’¾", "success");
        }

        function resetAllData() {
            const confirmButton = event.target;
            const originalText = confirmButton.textContent;
            
            confirmButton.innerHTML = '<div class="text-3xl mb-3">âš ï¸</div><h4 class="font-bold text-red-800 mb-2">Confirmar ExclusÃ£o?</h4><p class="text-sm text-red-600">Clique novamente para confirmar</p>';
            
            const timeout = setTimeout(() => {
                confirmButton.innerHTML = '<div class="text-3xl mb-3">ğŸ—‘ï¸</div><h4 class="font-bold text-red-800 mb-2">Limpar Dados</h4><p class="text-sm text-red-600">Remover todos os registros</p>';
            }, 5000);
            
            const confirmHandler = async () => {
                clearTimeout(timeout);
                confirmButton.removeEventListener('click', confirmHandler);
                
                // Clear all data arrays
                allData = [];
                clientsData = [];
                goalsData = [];
                marketplaceData = [];
                currentRecordCount = 0;
                
                // Update all displays
                updateDashboard();
                updatePublicidadeList();
                updateTradingList();
                updateClientsGrid();
                updateAnalytics();
                updateFinancialData();
                
                showToast("Todos os dados foram removidos! ğŸ—‘ï¸", "success");
                
                confirmButton.innerHTML = '<div class="text-3xl mb-3">ğŸ—‘ï¸</div><h4 class="font-bold text-red-800 mb-2">Limpar Dados</h4><p class="text-sm text-red-600">Remover todos os registros</p>';
            };
            
            confirmButton.addEventListener('click', confirmHandler);
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showSection('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        showSection('analytics');
                        break;
                    case 'n':
                        e.preventDefault();
                        showAddTradingForm();
                        break;
                    case 'k':
                        e.preventDefault();
                        document.getElementById('client-search')?.focus();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportAllData();
                        break;
                }
            }
        });

        // Enhanced Data Handler
        const enhancedDataHandler = {
            onDataChanged(data) {
                allData = data;
                currentRecordCount = data.length;
                updateDashboard();
                updatePublicidadeList();
                updateTradingList();
                updateAnalytics();
                updateFinancialData();
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Add event listeners for forms
        document.getElementById('client-form').addEventListener('submit', handleClientSubmit);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e3659707777b55',t:'MTc2MzA5MDY3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
